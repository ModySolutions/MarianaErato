#!/bin/bash
ROOT_DIR=$(pwd)
YML_FILE="${ROOT_DIR}/wp-cli.yml"

if [[ "$1" == @* ]]; then
    ALIAS="${1#@}"
    shift

    if [ ! -f "$YML_FILE" ]; then
        echo "Error: wp-cli.yml not found in $(pwd)"
        exit 1
    fi

    CONTAINER_NAME=$(grep -A 1 "@$ALIAS:" "$YML_FILE" | grep 'ssh:' | sed -E 's/.*@([^ ]+).*/\1/')

    if [ -z "$CONTAINER_NAME" ]; then
        echo "Error: Alias @$ALIAS not found in $YML_FILE"
        exit 1
    fi

    if [ -t 0 ]; then
        TTY_FLAG="-it"
    else
        TTY_FLAG="-i"
    fi
    docker exec $TTY_FLAG -u www-data "$CONTAINER_NAME" wp "$@"
else
    echo "Error: This wrapper requires a site alias (e.g., wp @ei <command>)"
    exit 1
fi